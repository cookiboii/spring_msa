pipeline {
    agent any
    environment{
        SERVICE_DIRS ="config-service , discovery-service ,gateway-service ,user-service ,product-service,ordering-service"

    }

    stages {

        stage('Pull code from GitHub') {
            steps {
                // 젠킨스와 연결된 SCM에서 코드를 가져옵니다.
                checkout scm
            }
        }

        stage('Build code with Gradle') {
            steps {
                script {
                     def serviceDirs = env.SERVICE_DIRS.split(",")
                     serviceDirs.each{ service ->


                        sh   """
                              echo "building  ${service}..."
                              cd${service}
                              ./gradlew clean build -x test
                              ls -al ./build/libs
                              cd ..
                             """


                     }

                }
            }
        }

    }
}
